/* Rollout name
   Rollout types:
   -COD = code only
   -SET = setup, config only
   -SFX = setup fix, fix on config only
   -(TMP, BCK, RBK are excluded in auto rollout logic for Starware)
 */
publish data
 where rollout_name = "USR-RFH-WM.00205.DEV.AFF-CFG-009_ADD_AREA_H255_V03"
/* Add Readme notes, start with the rollout version, this will be included in the generated readme file */
   and rollout_readme_release_notes = "
-V01: Add area H255 and related config
-V02: Include delete script for old config
-V03: Deliver locations without resource code"
|
/* Requirements */
/*  specify 1 or more rollouts below, this will generate a check during rollout, if the specified rollouts are not found the rollout process will stop */
/*{
   publish data
   where required_rollout_id = '131'
   and rollout_type = 'COD'
   and minimal_version = 'v01'
   and excluded_server_types =
   ['AA',
   'PA']
   } >> required_rollouts
   |*/
{
    [select '----' as wh_name,
            '----' as wh_id,
            '----' as query_wh_id,
            '' as remote_prefix,
            '[USE AMRWMSMD22];' as db_prefix
       from dual] &
    [select 'AMR' as wh_name,
            '1' as wh_id,
            '1' as query_wh_id,
            'remote("http://rfh-wms-server:4600/service")' as remote_prefix,
            '[USE AMRWMSMD22];' as db_prefix
       from dual] &
    [select 'NLW' as wh_name,
            '2' as wh_id,
            '2' as query_wh_id,
            'remote("http://rfh-wms-server:4600/service")' as remote_prefix,
            '[USE NLWWMSMD22];' as db_prefix
       from dual] &
    [select 'RBG' as wh_name,
            '3' as wh_id,
            '3' as query_wh_id,
            'remote("http://rfh-wms-server:4600/service")' as remote_prefix,
            '[USE RBGWMSMD22];' as db_prefix
       from dual] &
    [select 'EEL' as wh_name,
            '7' as wh_id,
            '7' as query_wh_id,
            'remote("http://rfh-wms-server:4600/service")' as remote_prefix,
            '[USE EELWMSMD22];' as db_prefix
       from dual]
} >> res_wh
|
{
    /* Rollout Information */
    publish data
     where type = "comment"
       and comment = "##### Rollout generated by 'create usr rollout package' for rollout " || @rollout_name || " at " || sysdate || " #####" &
    /* Generic rollout files. (copy the files to the indicated server directory before generating the rollout) */
    publish data
     where type = "file-include"
       and server_dir = "$LESDIR/scripts/rollout_gen/generic/"
       and server_file = "rollout.v02.pl"
       and package_dir = ""
       and package_file = "rollout.pl"
       and include_in_rollout_script = 0 &
    if (@required_rollouts)
    {
        publish data
         where type = 'rollout-script-text'
           and text = "RUNMSQL $SOURCEDIR/pkg/scripts/00_Rollout_requirements.msql"
    } &
    /* MSQL scripts (copy the files to the indicated server directory before generating the rollout) */
    publish data
     where type = "comment"
       and comment = "MSQL" &
    publish data
     where type = "msql"
       and server_dir = "$LESDIR/scripts/rollout_gen/" || @rollout_name || "/scripts/"
       and server_file = "20_delete_data.msql" &
    /* JAVA MTFCLIENT SOURCE FILES */
    publish data
     where type = "comment"
       and comment = "JAVA-MTFCLIENT-SOURCE-FILES" &
    /* JAVA MTFCLIENT LIB FILES */
    /* We don't build on the server (yet) becasue ant is not installed. So we need to copy the jar files too. */
    publish data
     where type = "comment"
       and comment = "JAVA-MTFCLIENT-LIB-FILES" &
    /************************************************************
     * CORE ROLLOUT (NOT WH SPECIFIC)
     ************************************************************/
    publish data
     where type = "comment"
       and comment = "***CORE ROLLOUT (NOT WH SPECIFIC)***" &
    /* INTERFACES */
    publish data
     where type = "comment"
       and comment = "INTERFACES" &
    /* REPORTS */
    publish data
     where type = "comment"
       and comment = "REPORTS" &
    /* LABELS */
    publish data
     where type = "comment"
       and comment = "LABELS" &
    publish data
     where type = "comment"
       and comment = "WEB-SERVICE" &
    /* COMMANDS */
    publish data
     where type = "comment"
       and comment = "COMMANDS" &
    /* TRIGGERS */
    publish data
     where type = "comment"
       and comment = "TRIGGERS" &
    /************************************************************
     * MLOAD - CORE ROLLOUT (NOT WH SPECIFIC)
     ************************************************************/
    publish data
     where type = "comment"
       and comment = "***MLOAD - CORE ROLLOUT (NOT WH SPECIFIC)***" &
    /************************************************************
     * WAREHOUSE 1 (AMR) SPECIFIC ROLLOUT
     ************************************************************/
    publish data
     where type = "comment"
       and comment = "***WAREHOUSE 1 (AMR) SPECIFIC ROLLOUT***" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "aremst"
       and name = "aremst"
       and query = "[select * from aremst where arecod in ('H255')]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "wkamst"
       and name = "wkamst"
       and query = "[select * from wkamst where wrkare in ('WA-2-007') and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "zonmst"
       and name = "zonmst"
       and query = "[select * from zonmst where wrk_zone_id in (10020) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "sto_zone"
       and name = "sto_zone"
       and query = "[select * from sto_zone where sto_zone_id in (10019) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pck_zone"
       and name = "pck_zone"
       and query = "[select * from pck_zone where pck_zone_id in (10009) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "mov_zone"
       and name = "mov_zone"
       and query = "[select * from mov_zone where mov_zone_id in (10077, 10078, 10079, 10080, 10081, 10082) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "mov_path"
       and name = "mov_path"
       and query = "[select * from mov_path where src_mov_zone_id in (10077)] &
                    [select * from mov_path where dst_mov_zone_id in (10077)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "mov_path_dtl"
       and name = "mov_path_dtl"
       and query = "[select * from mov_path_dtl where src_mov_zone_id in (10077)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "wh_serv_exitpnt_mov_zone"
       and name = "wh_serv_exitpnt_mov_zone"
       and query = "[select * from wh_serv_exitpnt_mov_zone where serv_id in ('CMPL-LBL-DOCS') and src_mov_zone_id = 10078 and wh_id = '1'] &
                    [select * from wh_serv_exitpnt_mov_zone where serv_id in ('USR-SEND-STATUS', 'USR-PRINT-PACKSLIP') and dst_mov_zone_id in (10080, 10081) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pck_zone_ver_flg"
       and name = "pck_zone_ver_flg"
       and query = "[select * from pck_zone_ver_flg where src_pck_zone_id = 10009]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "alloc_search_path_rule"
       and name = "alloc_search_path_rule"
       and query = "[select * from alloc_search_path_rule where pck_zone_id = 10009]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pcklst_select_cri"
       and name = "pcklst_select_cri"
       and query = "[select * from pcklst_select_cri where pcklst_rule_id in (70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pcklst_rule"
       and name = "pcklst_rule"
       and query = "[select * from pcklst_rule where pcklst_rule_id in (70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pcklst_grp_cri"
       and name = "pcklst_grp_cri"
       and query = "[select * from pcklst_grp_cri where pcklst_rule_id in (70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pcklst_rule_grp"
       and name = "pcklst_rule_grp"
       and query = "[select * from pcklst_rule_grp where pcklst_rule_grp_id in (50, 51, 52, 53, 54, 55, 56, 57, 58)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pcklst_rule_grp_dtl"
       and name = "pcklst_rule_grp_dtl"
       and query = "[select * from pcklst_rule_grp_dtl where pcklst_rule_id in (70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "pcklst_seq_cri"
       and name = "pcklst_seq_cri"
       and query = "[select * from pcklst_seq_cri where pcklst_rule_id in (70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "locmst"
       and name = "locmst"
       and query = "[select * from locmst where mov_zone_id in (10077, 10078, 10079, 10080, 10081, 10082) and wh_id = '1']" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "dscmst"
       and name = "dscmst"
       and query = "[select * from dscmst where colnam = 'arecod|wh_id' and colval in ('H255|1') ] &
                    [select * from dscmst where colnam = 'wrkare|wh_id' and colval in ('WA-2-007|1')] &
                    [select * from dscmst where colnam = 'wrkzon|wh_id' and colval in ('WZ-2-H255|1')] &
                    [select * from dscmst where colnam = 'sto_zone_cod|wh_id' and colval in ('H255-S-01|1')] &
                    [select * from dscmst where colnam = 'pck_zone_cod|wh_id' and colval in ('H255-P-01|1')] &
                    [select * from dscmst where colnam = 'mov_zone_cod|wh_id' and colval in ('H255-M-01-O|1', 'H255-M-01-P|1', 'H255-M-01-EU|1', 'H255-M-01-U|1', 'H255-M-02-U|1', 'H255-M-03-U|1')] &
                    [select * from dscmst where colnam = 'dst_mov_zone_id|lodlvl|src_mov_zone_id' and colval like '%|10077'] &
                    [select * from dscmst where colnam = 'dst_mov_zone_id|lodlvl|src_mov_zone_id' and colval like '10077%'] &
                    [select * from dscmst where colnam = 'pcklst_rule_id' and colval in (70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82)] &
                    [select * from dscmst where colnam = 'pcklst_rule_grp_id' and colval in (50, 51, 52, 53, 54, 55, 56, 57, 58)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "poldat"
       and name = "poldat"
       and query = "[select * from poldat where  polcod = 'ALLOCATE-INV' and polvar = 'RESCOD-ZONE-DEF-ASSC' and polval = 'RESCOD-ZONE-FIXED' and  wh_id_tmpl = '1' and rtstr1 in (10077, 10078, 10079, 10080, 10081, 10082)] &
                    [select * from poldat where  polcod = 'ALLOCATE-LOC' and polvar = 'RESCOD-ZONE-DEF-ASSC' and polval = 'RESCOD-ZONE-FIXED'  and wh_id_tmpl = '1' and rtstr1 in (10077, 10078, 10079, 10080, 10081, 10082)] &
                    [select * from poldat where polcod = 'RDTALLOPR' and polvar = 'TRANSFER' and polval = 'ALLOW-PARTIAL-TRANSFER' and rtnum2 in (10077, 10078, 10079, 10080, 10081, 10082) and wh_id_tmpl = '1']&
                    [select* from poldat where polcod = 'MOVE-INVENTORY' and polvar = 'ATTACHMENT-STRATEGY-FOR-ZONES' and polval = 'NEVER-ATTACH' and rtnum1 in (10077, 10078, 10079, 10080, 10081, 10082) and wh_id_tmpl = '1'] &
                    [select* from poldat where polcod = 'USR-PICKING' and polvar = 'CUBING' and polval = 'EXCLUDED-PICK-ZONES' and rtstr1 = 'H255-P-01' and wh_id_tmpl = '1'] &
                    [select * from poldat where polcod = 'USR-INTEGRATOR' and polvar = 'TRANSACTIONS' and polval = 'SEND_STATUS' and rtnum2 in (10080, 100081) and wh_id_tmpl = '1'] &
                    [select * from poldat where polcod = 'USR-INVENTORY' and polvar = 'MULTIPLE-LPN-HANDLING' and polval = 'CREATE_PICK_DEP_MOVE' and rtstr1 in (10080, 100081) and wh_id_tmpl = '1'] &
                    [select* from poldat where polcod = 'USR-PICKING' and polvar = 'PICK-RELEASE' and polval = 'AUTO-RELEASE-RULE-ASYNC' and wh_id_tmpl = '1' and rtnum2 in (70, 71, 72, 73, 74, 75, 79, 80, 81, 82)]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "usr_delivery"
       and name = "usr_delivery"
       and query = "[select * from usr_delivery where uc_delivery_id >= 1295]" &
    publish data
     where type = "mload"
       and mload_wh_id = '1'
       and table = "usr_delivery_gln"
       and name = "usr_delivery_gln"
       and query = "[select * from usr_delivery_gln where uc_delivery_id >= 1295]" &
    /************************************************************
     * WAREHOUSE 2 (NLW) SPECIFIC ROLLOUT
     ************************************************************/
    publish data
     where type = "comment"
       and comment = "***WAREHOUSE 2 (NLW) SPECIFIC ROLLOUT***" &
    /************************************************************ 
     * WAREHOUSE 3 (RBG) SPECIFIC ROLLOUT 
     ************************************************************/
    publish data
     where type = "comment"
       and comment = "***WAREHOUSE 3 (RBG) SPECIFIC ROLLOUT***" &
    /************************************************************ 
     * WAREHOUSE 7 (EEL) SPECIFIC ROLLOUT 
     ************************************************************/
    publish data
     where type = "comment"
       and comment = "***WAREHOUSE 7 (EEL) SPECIFIC ROLLOUT***" &
    /* REBUILDS */
    publish data
     where type = "comment"
       and comment = "REBUILDS" &
    publish data
     where type = "rollout-script-text"
       and text = "MBUILD" &
    /* MSQL scripts (copy the files to the indicated server directory before generating the rollout) */
    publish data
     where type = "comment"
       and comment = "MSQL" &
    publish data
     where type = "msql"
       and server_dir = "$LESDIR/scripts/rollout_gen/" || @rollout_name || "/scripts/"
       and server_file = "90_post_installation.msql" &
    /* DO NOT EDIT BELOW THIS */
    publish data
     where type = 'rollout-script-text'
       and text = "RUNMSQL $SOURCEDIR/pkg/scripts/90_Rollout_install_insert.msql"
} >> res_rollout
|
{
    {
        publish data combination
         where res = @res_rollout
        |
        filter data
         where moca_filter_level = 1
           and query_wh_id = nvl(@query_wh_id, @mload_wh_id)
    } >> res_rollout
    |
    merge result sets with data
     where resultset = @res_rollout
       and additionalresultset = @res_wh
       and keycolumns = 'query_wh_id'
    |
    filter data
     where moca_filter_level = 1
       and query = @db_prefix || @query
} >> res_rollout
|
/* DO NOT EDIT ABOVE THIS */
create usr rollout package
 where rollout_name = @rollout_name
   and res_rollout = @res_rollout
   and rollout_readme_release_notes = @rollout_readme_release_notes
   and required_rollouts = @required_rollouts
   and ignore_mload_nodata = 0
   and remove_rollout_dir_if_exists = 1
   and generate_rollout_shared = 1
   and zip_rollout = 1
   and list_content_after_create = 1